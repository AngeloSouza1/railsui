<%# Card - User card with content and dropdown %>
<div class="my-16" data-controller="anchor">

  <%= render "railsui/shared/sticky_subhead", title: "Cards", subtitle: "User card with content and dropdown" %>

  <%= doc_label(:javascript) %>

  <div class="prose max-w-full dark:prose-invert mb-6">
    <p>Use the <%= code('data-controller="dropdown"') %> attribute to initialize a new dropdown component using <%= link_to "Stimulus.js", "https://stimulus.hotwired.dev/", target: :_blank %>. To add transition effects to components like dropdowns, we prefer an additional dependency called <%= link_to "stimulus-use", "https://stimulus-use.github.io/stimulus-use/", target: :_blank %>. Read the <%= link_to "Dropdown component documentation", systems_components_dropdowns_path %> for more information.</p>

    <div class="px-4 py-2 rounded-lg bg-indigo-50 flex items-center pointer-events-none select-none">
      <%= icon "bell", classes: "text-indigo-500 w-5 h-5" %>
      <p class="m-0 text-indigo-900 ml-2">Stimulus.js and stimulus-use are <strong>already installed</strong> as a dependency of the <%= Railsui::config.theme.titleize %> theme.</p>
    </div>
  </div>

  <div class="bg-slate-50 p-6 rounded shadow-inner">
   <div class="rounded-lg shadow-lg shadow-slate-300/30 bg-white p-6 flex flex-wrap items-center w-auto">
    <%= image_tag unsplash_url(item: "female portrait", width: 200, height: 200), class: "object-cover w-16 h-16 rounded-full flex-shrink-0" %>
      <div class="pl-3 flex-1 flex flex-col items-start space-y-px text-slate-700">
        <p class="font-bold">Jane Doe</p>
        <p class="text-sm"><%= Time.zone.now.strftime("%B %e at  %l:%M %p") %></p>
      </div>
      <div data-controller="dropdown" class="relative">
        <button type="button" data-action="dropdown#toggle click@window->dropdown#hide" class="relative group border-transparent border transition ease-in-out focus:ring-4 w-8 h-8 flex items-center justify-center rounded-lg hover:border-slate-200 focus:ring-slate-50 hover:bg-white hover:shadow-sm focus:border-slate-200">
          <%= icon "ellipsis-vertical", classes: "w-6 h-6 text-slate-500 group-hover:text-indigo-500" %>
        </button>
        <ul
          class="hidden transition transform origin-to-right absolute right-0 top-9 bg-white rounded-lg shadow-xl shadow-slate-900/10 border border-slate-200 min-w-[200px] z-50 py-2"
          data-dropdown-target="menu"
          data-transition-enter-from="opacity-0 scale-95"
          data-transition-enter-to="opacity-100 scale-100"
          data-transition-leave-from="opacity-100 scale-100"
          data-transition-leave-to="opacity-0 scale-95"
          >
          <li>
            <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Follow</a>
          </li>
          <li>
            <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Save for later</a>
          </li>
          <li>
            <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Mute</a>
          </li>
        </ul>
      </div>
      <div class="prose prose-sm mt-6 max-w-full opacity-20 pointer-events-none select-none">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Voluptas quod maxime doloremque velit sapiente aut inventore laboriosam perferendis facere cumque. Rem quibusdam maxime quia temporibus, esse suscipit corrupti aperiam repudiandae.</div>
    </div>
  </div>

<% content_for :html, flush: true do %>
<div class="rounded-lg shadow-lg shadow-slate-300/30 bg-white p-6 flex flex-wrap items-center w-auto">
  <%= image_tag unsplash_url(item: "female portrait", width: 200, height: 200), class: "object-cover w-16 h-16 rounded-full flex-shrink-0" %>
  <div class="pl-3 flex-1 flex flex-col items-start space-y-px text-slate-700">
    <p class="font-bold">Jane Doe</p>
    <p class="text-sm"><%= Time.zone.now.strftime("%B %e at  %l:%M %p") %></p>
  </div>
  <!-- Dropdown ~ dropdown_controller -->
  <div data-controller="dropdown" class="relative">
    <button
      type="button"
      data-action="dropdown#toggle click@window->dropdown#hide"
      class="relative group border-transparent border transition ease-in-out focus:ring-4 w-8 h-8 flex items-center justify-center rounded-lg hover:border-slate-200 focus:ring-slate-50 hover:bg-white hover:shadow-sm focus:border-slate-200">
      <%%= icon "ellipsis-vertical", classes: "w-6 h-6 text-slate-500 group-hover:text-indigo-500" %>
    </button>
    <ul
      class="hidden transition transform origin-to-right absolute right-0 top-9 bg-white rounded-lg shadow-xl shadow-slate-300/25 border border-slate-200 min-w-[200px] z-50 py-2"
      data-dropdown-target="menu"
      data-transition-enter-from="opacity-0 scale-95"
      data-transition-enter-to="opacity-100 scale-100"
      data-transition-leave-from="opacity-100 scale-100"
      data-transition-leave-to="opacity-0 scale-95"
      >
      <li>
        <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Follow</a>
      </li>
      <li>
        <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Save for later</a>
      </li>
      <li>
        <a href="#" class="px-4 py-[.4rem] hover:text-indigo-600 block">Mute</a>
      </li>
    </ul>
  </div>
  <!-- additional content -->
</div>
<% end %>

<% content_for :erb, flush: true do %>
<div class="rounded-lg shadow-lg shadow-slate-300/30 bg-white p-6 flex flex-wrap items-center w-auto">
  <%%= image_tag "#", class: "object-cover w-16 h-16 rounded-full flex-shrink-0" %>
  <div class="pl-3 flex-1 flex flex-col items-start space-y-px text-slate-700">
    <p class="font-bold">Jane Doe</p>
    <p class="text-sm"><%%= Time.zone.now.strftime("%B %e at  %l:%M %p") %></p>
  </div>
  <!-- Dropdown ~ dropdown_controller -->
  <div data-controller="dropdown" class="relative">
    <button
      type="button"
      data-action="dropdown#toggle click@window->dropdown#hide"
      class="relative group border-transparent border transition ease-in-out focus:ring-4 w-8 h-8 flex items-center justify-center rounded-lg hover:border-slate-200 focus:ring-slate-50 hover:bg-white hover:shadow-sm focus:border-slate-200">
      <%%= icon "ellipsis-vertical", classes: "w-6 h-6 text-slate-500 group-hover:text-indigo-500" %>
    </button>
    <ul
      class="hidden transition transform origin-to-right absolute right-0 top-9 bg-white rounded-lg shadow-xl shadow-slate-300/25 border border-slate-200 min-w-[200px] z-50 py-2"
      data-dropdown-target="menu"
      data-transition-enter-from="opacity-0 scale-95"
      data-transition-enter-to="opacity-100 scale-100"
      data-transition-leave-from="opacity-100 scale-100"
      data-transition-leave-to="opacity-0 scale-95"
      >
      <li>
        <%%= link_to "Follow", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block" %>
      </li>
      <li>
        <%%= link_to "Save for later", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block" %>
      </li>
      <li>
        <%%= link_to "Mute", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block" %>
      </li>
    </ul>
  </div>
  <!-- additional content -->
</div>
<% end %>

<% content_for :haml, flush: true do %>
.rounded-lg.shadow-lg.shadow-slate-300/30.bg-white.p-6.flex.flex-wrap.items-center.w-auto
  = image_tag "#", class: "object-cover w-16 h-16 rounded-full flex-shrink-0"
  .pl-3.flex-1.flex.flex-col.items-start.space-y-px.text-slate-700
    %p.font-bold Jane Doe
    %p.text-sm= Time.zone.now.strftime("%B %e at  %l:%M %p")
  / Dropdown ~ dropdown_controller
  .relative{"data-controller" => "dropdown"}
    %button.relative.group.border-transparent.border.transition.ease-in-out.focus:ring-4.w-8.h-8.flex.items-center.justify-center.rounded-lg.hover:border-slate-200.focus:ring-slate-50.hover:bg-white.hover:shadow-sm.focus:border-slate-200{"data-action" => "dropdown#toggle click@window->dropdown#hide", type: "button"}
      = icon "ellipsis-vertical", classes: "w-6 h-6 text-slate-500 group-hover:text-indigo-500"
    %ul.hidden.transition.transform.origin-to-right.absolute.right-0.top-9.bg-white.rounded-lg.shadow-xl.border.border-slate-200.z-50.py-2.shadow-slate-300/25.min-w-[200px]{ "data-dropdown-target" => "menu", "data-transition-enter-from" => "opacity-0 scale-95", "data-transition-enter-to" => "opacity-100 scale-100", "data-transition-leave-from" => "opacity-100 scale-100", "data-transition-leave-to" => "opacity-0 scale-95"}
      %li
        = link_to "Follow", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block"
      %li
        = link_to "Save for later", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block"
      %li
        = link_to "Mute", "#", class: "px-4 py-[.4rem] hover:text-indigo-600 block"
  / additional content
<% end %>

<% content_for :js, flush: true do %>
// app/javascript/controllers/dropdown_controller.js

import { Controller } from '@hotwired/stimulus'
import { useTransition } from 'stimulus-use'

export default class extends Controller {
  static targets = ['menu', 'trigger']

  connect() {
    useTransition(this, {
      element: this.menuTarget,
    })
  }

  toggle() {
    this.toggleTransition()
  }

  hide(event) {
    if (
      !this.element.contains(event.target) &&
      !this.menuTarget.classList.contains('hidden')
    ) {
      this.leave()
    }
  }
}
<% end %>

<%= render_snippet %>
</div>
