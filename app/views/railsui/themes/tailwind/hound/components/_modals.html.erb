<%# Modals - Example %>
<div class="mb-16 mt-6">
  <%= doc_label :javascript %>

  <div class="prose dark:prose-invert mb-6 max-w-full">
    <p>Use the bundled model component to add dialogs to your application. These could be leveraged for notifications, notices, or custom content.</p>
  </div>

  <%= render callout do %>
  <p class="mb-1">Modals require <%= link_to "Stimulus.js", "https://stimulus.hotwired.dev/", target: :_blank %> and <%= link_to "stimulus-use", "https://github.com/stimulus-use/stimulus-use", target: :_blank %> for transition effects. The <code>modal_controller.js</code> controller is integrated to the <%= Railsui.config.theme.humanize %> theme by default.</p>
  <% end %>

  <%= render "railsui/shared/sticky_subhead", title: "Modals", subtitle: "Base" %>

<div data-controller="modal">
  <a href="#" data-action="click->modal#open" class="btn btn-primary">
    Open modal
  </a>

  <div
    data-modal-target="container origin-bottom"
    data-action="keyup@window->modal#closeWithKey"
    class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="h-screen w-full relative flex items-center justify-center">
      <div
      data-modal-target="content"
      data-transition-enter-active="transition ease-out duration-300"
      data-transition-enter-from="transform opacity-0 scale-95"
      data-transition-enter-to="transform opacity-100 scale-100"
      data-transition-leave-active="transition ease-in duration-300"
      data-transition-leave-from="transform opacity-100 scale-100"
      data-transition-leave-to="transform opacity-0 scale-95"
      class="hidden rounded shadow-xl max-w-lg bg-white m-1 p-8 prose prose-indigo">
        <h2>Modal Title</h2>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, veritatis! Nulla, enim incidunt.</p>

        <div class="flex justify-end items-center flex-wrap space-x-4">
          <button class="btn btn-white" data-action="click->modal#close">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :html, flush: true do %>
<div data-controller="modal">
  <a href="#" data-action="click->modal#open" class="btn btn-primary">
    Open modal
  </a>

  <div
    data-modal-target="container"
    data-action="keyup@window->modal#closeWithKey"
    class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="h-screen w-full relative flex items-center justify-center">
      <div
        data-modal-target="content"
        data-transition-enter-active="transition ease-out duration-300"
        data-transition-enter-from="transform opacity-0 scale-95"
        data-transition-enter-to="transform opacity-100 scale-100"
        data-transition-leave-active="transition ease-in duration-300"
        data-transition-leave-from="transform opacity-100 scale-100"
        data-transition-leave-to="transform opacity-0 scale-95"
        class="hidden rounded shadow-xl max-w-lg bg-white m-1 p-8 prose prose-indigo origin-bottom">
        <h2>Modal Title</h2>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, veritatis! Nulla, enim incidunt.</p>
        <div class="flex justify-end items-center flex-wrap space-x-4">
          <button class="btn btn-white" data-action="click->modal#close">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
<% end %>

<% content_for :haml, flush: true do %>
%div{"data-controller" => "modal"}
  %a.btn.btn-primary{"data-action" => "click->modal#open", href: "#"}
    Open modal

  .hidden.fixed.inset-0.z-50.overflow-y-auto{"data-action" => "keyup@window->modal#closeWithKey", "data-modal-target" => "container"}
    .h-screen.w-full.relative.flex.items-center.justify-center
      .hidden.rounded.shadow-xl.max-w-lg.bg-white.m-1.p-8.prose.prose-indigo.origin-bottom{"data-modal-target" => "content", "data-transition-enter-active" => "transition ease-out duration-300", "data-transition-enter-from" => "transform opacity-0 scale-95", "data-transition-enter-to" => "transform opacity-100 scale-100", "data-transition-leave-active" => "transition ease-in duration-300", "data-transition-leave-from" => "transform opacity-100 scale-100", "data-transition-leave-to" => "transform opacity-0 scale-95"}
        %h2 Modal Title
        %p Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, veritatis! Nulla, enim incidunt.
        .flex.justify-end.items-center.flex-wrap.space-x-4
          %button.btn.btn-white{"data-action" => "click->modal#close"} Close
<% end %>

<% content_for :js, flush: true do %>
// app/javascript/controllers/modal_controller.js

import { Controller } from "@hotwired/stimulus"
import { useTransition } from 'stimulus-use'

export default class extends Controller {
  static targets = ['container', 'content']

  connect() {
    useTransition(this, {
      element: this.contentTarget,
    })
  }

  open() {
    this.enableAppearance()
    this.toggleTransition()
  }

  close() {
    this.leave();
    this.disableAppearance()
  }

  closeWithKey(e){
    if (e.keyCode === 27 && !this.containerTarget.classList.contains('hidden')) {
      this.close(e);
    }
  }

  enableAppearance() {
    this.containerTarget.classList.add("bg-black/80")
    this.containerTarget.classList.remove('hidden')
  }

  disableAppearance() {
    this.containerTarget.classList.add('hidden')
    this.containerTarget.classList.remove("bg-black/80")
  }

  disconnect() {
    this.toggleTransition()
  }
}

<% end %>

<%= render_snippet(html_filename: "modal.html", haml_filename: "modal.haml", js_filename: "modal_controller.js") %>
</div>
